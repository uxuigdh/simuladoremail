<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Vista previa email</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;700&display=swap" rel="stylesheet">
  <link rel="icon" href="favicon.png" type="image/png">

  <style>
    body { font-family: "Segoe UI", Tahoma, Arial, sans-serif; background: #f4f6f8; margin:0; color:#222; font-size:14px; }
    .email { background:white; max-width:700px; margin:32px auto; padding:24px; border:1px solid #dadce0; border-radius:8px; }
    .header { background:#3D57C7; color:white; padding:12px; font-size:15px; }
    .meta { padding-bottom:12px; margin-bottom:16px; border-bottom:1px solid #dadce0; }
    .meta p { margin:4px 0; font-size:13px; }
    .meta strong { color:#5f6368; }
    .attachment { background:#f1f3f4; border:1px solid #dadce0; padding:8px 12px; border-radius:6px; display:flex; align-items:center; gap:8px; margin-top:10px; }
    .clip-icon svg { width:20px; height:20px; fill:none; stroke:#4A4D52; stroke-width:1.8; stroke-linecap:round; stroke-linejoin:round; }
    #body { white-space: pre-line; font-size:14px; line-height:1.5; margin-top:16px; }
    footer { margin-top:40px; padding-top:12px; font-size:12px; color:#5f6368; border-top:1px solid #dadce0; line-height:1.4; }
    footer .separator { margin:6px 0; font-family: monospace; }
    footer .brand { font-family:"Sora",sans-serif; font-weight:700; color:#3D57C7; font-size:13px; }
    .actions { text-align:center; margin:32px auto 40px; }
    button { padding:10px 18px; background:#005E5C; color:white; border:none; cursor:pointer; font-size:14px; border-radius:4px; }
    button:hover { background:#004746; }

    @media print {
      * { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      body { background:white; font-size:13px; line-height:1.35; margin:0; }
      .actions { display:none; }
      .email { max-width:100%; margin:0; padding:24px 28px; border:none; border-radius:0; }
      .attachment { background:#eeeeee !important; border:1px solid #d0d0d0; padding:8px 12px; margin-top:4px; }
      footer { margin-top:24px; }
    }
  </style>
</head>
<body>

<div class="email">
  <div class="header"></div>

  <div class="meta">
    <p><strong>De:</strong> <span id="from"></span></p>
    <p><strong>Para:</strong> <span id="to"></span></p>
    <p><strong>Asunto:</strong> <span id="subject"></span></p>
    <p><strong>Fecha:</strong> <span id="date"></span> <span id="time"></span></p>
  </div>

  <div id="attachment" class="attachment" style="display:none;">
    <span class="clip-icon" aria-hidden="true">
      <svg viewBox="0 0 24 24">
        <path d="M16.5 6.5v9a4.5 4.5 0 1 1-9 0V5a3 3 3 0 1 6 0v8.5a1.5 1.5 0 1 1-3 0V6.5"/>
      </svg>
    </span>
    <strong id="attachmentName"></strong>
  </div>

  <div id="body"></div>

  <footer></footer>
</div>

<div class="actions">
  <button onclick="window.print()">Imprimir / Guardar como PDF</button>
</div>

<script>
function formatFechaLarga(fechaISO) {
  if (!fechaISO) return "";
  const fecha = new Date(fechaISO + "T00:00:00");
  return fecha.toLocaleDateString("es-AR", { day:"numeric", month:"long", year:"numeric" });
}

const data = JSON.parse(localStorage.getItem("emailData"));

if (data) {
  document.getElementById("from").innerText = data.from || "";
  document.getElementById("to").innerText = data.to || "";
  document.getElementById("subject").innerText = data.subject || "";
  document.getElementById("date").innerText = formatFechaLarga(data.date);
  document.getElementById("time").innerText = data.time ? data.time + " hs." : "";
  document.getElementById("body").innerText = data.body || "";

  if (data.attachment && data.attachment.trim() !== "") {
    document.getElementById("attachmentName").innerText = data.attachment;
    document.getElementById("attachment").style.display = "inline-flex";
  }

  // Construir footer din√°mico
  if (data.department && data.office && data.footer) {
    const parts = data.footer.split("|");
    const footerHTML = `
      <strong>${data.department}</strong><br>
      ${data.office}<br>
      <div class="separator">---------------------------</div>
      ${parts[1]}<br>
      ${parts[0]}<br>
      www.parquesalud.com.ar
      <div class="brand">PARQUE SALUD. A la par.</div>
    `;
    document.querySelector("footer").innerHTML = footerHTML;
  }
}
</script>

</body>
</html>
